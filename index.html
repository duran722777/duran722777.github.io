<script>
// ----------------------- ì „ì—­ -----------------------
let currentGame=null;
const scoreBox=document.getElementById('scoreBox');
const highScoreBox=document.getElementById('highScoreBox');
const timeBox=document.getElementById('timeBox');

function animateScore(score,element){
  element.style.transform='scale(1.5)';
  element.textContent=`ì ìˆ˜: ${score}`;
  setTimeout(()=>element.style.transform='scale(1)',200);
}

function updateHighScore(game,score){
  const key='highScore_'+game;
  let high=localStorage.getItem(key) || 0;
  if(score>high){ localStorage.setItem(key,score); high=score; showCongrats(); }
  return high;
}

function showCongrats(){
  const c=document.createElement('div');
  c.className='congrats';
  c.textContent='ğŸ‰ ì‹ ê¸°ë¡! ğŸ‰';
  c.style.left=window.innerWidth/2-100+'px';
  c.style.top=100+window.scrollY+'px';
  document.body.appendChild(c);
  setTimeout(()=>c.remove(),2000);
}

// ----------------------- ê²Œì„: í´ë¦­ ì œí•œ -----------------------
document.getElementById('clickGameBtn').addEventListener('click',()=>{
  resetCookie();
  currentGame='clickGame';
  let score=0;
  scoreBox.textContent=`ì ìˆ˜: ${score}`;
  clickHint.textContent='10ì´ˆ ì•ˆì— ì¿ í‚¤ë¥¼ ìµœëŒ€í•œ í´ë¦­í•˜ì„¸ìš”!';
  clickHint.style.display='block';
  cookie.style.position='relative';
  cookie.style.left='0px';
  cookie.style.top='0px';

  const clickHandler=()=>{
    score++;
    animateScore(score,scoreBox);
    const rect=cookie.getBoundingClientRect();
    createGlitter(rect.left+rect.width/2, rect.top+rect.height/2);
  };
  cookie.addEventListener('click',clickHandler);

  let timeLeft=10;
  timeBox.textContent=`ë‚¨ì€ ì‹œê°„: ${timeLeft}s`;
  const timer=setInterval(()=>{
    timeLeft--;
    timeBox.textContent=`ë‚¨ì€ ì‹œê°„: ${timeLeft}s`;
  },1000);

  setTimeout(()=>{
    clearInterval(timer);
    cookie.removeEventListener('click',clickHandler);
    clickHint.textContent=`ê²Œì„ ì¢…ë£Œ! ìµœì¢… ì ìˆ˜: ${score}`;
    updateHighScore('clickGame',score);
    currentGame=null;
    timeBox.textContent='';
  },10000);
});

// ----------------------- ê²Œì„: ì›€ì§ì´ëŠ” ì¿ í‚¤ -----------------------
document.getElementById('moveGameBtn').addEventListener('click',()=>{
  resetCookie();
  currentGame='moveGame';
  let score=0;
  scoreBox.textContent=`ì ìˆ˜: ${score}`;
  clickHint.textContent='ì›€ì§ì´ëŠ” ì¿ í‚¤ë¥¼ í´ë¦­í•˜ì„¸ìš”!';
  clickHint.style.display='block';
  cookie.style.position='absolute';

  const moveInterval=setInterval(()=>{
    const x=Math.random()*(window.innerWidth-100);
    const y=window.scrollY+100+Math.random()*(window.innerHeight-200);
    cookie.style.left=`${x}px`;
    cookie.style.top=`${y}px`;
  },500); // ì†ë„ ì¦ê°€

  const clickHandler=()=>{
    score++;
    animateScore(score,scoreBox);
    const rect=cookie.getBoundingClientRect();
    createGlitter(rect.left+rect.width/2, rect.top+rect.height/2);
  };
  cookie.addEventListener('click',clickHandler);

  let timeLeft=15;
  timeBox.textContent=`ë‚¨ì€ ì‹œê°„: ${timeLeft}s`;
  const timer=setInterval(()=>{
    timeLeft--;
    timeBox.textContent=`ë‚¨ì€ ì‹œê°„: ${timeLeft}s`;
  },1000);

  setTimeout(()=>{
    clearInterval(moveInterval);
    clearInterval(timer);
    cookie.removeEventListener('click',clickHandler);
    clickHint.textContent=`ê²Œì„ ì¢…ë£Œ! ìµœì¢… ì ìˆ˜: ${score}`;
    updateHighScore('moveGame',score);
    currentGame=null;
    timeBox.textContent='';
  },15000);
});

// ----------------------- ì‘ì€ ìºë¦­í„° ëœë¤ ë“±ì¥ -----------------------
function spawnSmallChar(){
  if(Math.random()<0.03 && !currentGame){
    const char=document.createElement('img');
    char.src='https://cdn-icons-png.flaticon.com/512/616/616408.png';
    char.className='small-char';
    char.style.left=Math.random()*(window.innerWidth-50)+'px';
    char.style.top=(window.scrollY+50+Math.random()*(window.innerHeight-100))+'px';
    document.body.appendChild(char);
    char.addEventListener('click',()=>{
      const rect=char.getBoundingClientRect();
      createGlitter(rect.left+25, rect.top+25,'#ff0');
      popupScore(rect.left+25, rect.top+25,'+3');
      typeMessage('ì‘ì€ ì¹œêµ¬ê°€ í–‰ìš´ì„ ê°€ì ¸ì™”ì–´ìš”! ğŸ‰');
      char.remove();
    });
    setTimeout(()=>{ if(char.parentNode) char.remove(); },5000);
  }
}
setInterval(spawnSmallChar,1000);

// ----------------------- ì¿ í‚¤ ì´ˆê¸°í™” -----------------------
function resetCookie(){
  cookie.style.position='relative';
  cookie.style.left='0px';
  cookie.style.top='0px';
}
</script>
